openapi: 3.0.3
info:
  title: Freelance Monitor & Offer API
  version: 0.1.0
  description: |
    Rate limiting is enabled globally. Each response includes the following headers:
    - X-RateLimit-Limit: Maximum requests allowed per window
    - X-RateLimit-Remaining: Requests remaining in the current window
    - X-RateLimit-Reset: Seconds until the window resets
    Configure via environment variables RATE_LIMIT_REQUESTS (default 100) and RATE_LIMIT_WINDOW_SECS (default 60).
servers:
  - url: http://localhost:8080/api
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
  /clients:
    get:
      summary: List clients
      parameters:
        - name: limit
          in: query
          schema: { type: integer }
        - name: offset
          in: query
          schema: { type: integer }
        - name: sort
          in: query
          schema: { type: string, enum: [id, name, created_at] }
        - name: order
          in: query
          schema: { type: string, enum: [asc, desc] }
        - name: name
          in: query
          schema: { type: string }
      responses:
        '200': { description: OK }
    post:
      summary: Create client
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Client'
      responses:
        '201': { description: Created }
  /clients/{id}:
    get:
      summary: Get client
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
        '404': { description: Not found }
    put:
      summary: Update client
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Client'
      responses:
        '200': { description: OK }
        '404': { description: Not found }
    delete:
      summary: Delete client
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '204': { description: No Content }
        '404': { description: Not found }
  /offers:
    get:
      summary: List offers
      parameters:
        - name: limit
          in: query
          schema: { type: integer }
        - name: offset
          in: query
          schema: { type: integer }
        - name: sort
          in: query
          schema: { type: string, enum: [id, date, total_price] }
        - name: order
          in: query
          schema: { type: string, enum: [asc, desc] }
        - name: subject
          in: query
          schema: { type: string }
        - name: client_id
          in: query
          schema: { type: integer }
      responses:
        '200': { description: OK }
    post:
      summary: Create offer
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Offer'
      responses:
        '201': { description: Created }
  /offers/{id}:
    get:
      summary: Get offer
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
        '404': { description: Not found }
    put:
      summary: Update offer
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Offer'
      responses:
        '200': { description: OK }
        '404': { description: Not found }
    delete:
      summary: Delete offer
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '204': { description: No Content }
        '404': { description: Not found }
  /services:
    get:
      summary: List services
      parameters:
        - name: limit
          in: query
          schema: { type: integer }
        - name: offset
          in: query
          schema: { type: integer }
        - name: sort
          in: query
          schema: { type: string, enum: [id, domain, status, created_at] }
        - name: order
          in: query
          schema: { type: string, enum: [asc, desc] }
        - name: status
          in: query
          schema: { type: string }
        - name: domain
          in: query
          schema: { type: string }
        - name: client_id
          in: query
          schema: { type: integer }
      responses:
        '200': { description: OK }
    post:
      summary: Create service
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Service'
      responses:
        '201': { description: Created }
  /services/{id}:
    get:
      summary: Get service
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
        '404': { description: Not found }
    put:
      summary: Update service
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Service'
      responses:
        '200': { description: OK }
        '404': { description: Not found }
    delete:
      summary: Delete service
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '204': { description: No Content }
        '404': { description: Not found }
  /services/{id}/logs:
    get:
      summary: List uptime logs for a service
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
        - name: limit
          in: query
          required: false
          schema: { type: integer }
        - name: offset
          in: query
          required: false
          schema: { type: integer }
      responses:
        '200': { description: OK }
  /services/{id}/alerts:
    get:
      summary: List alerts for a service
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
        - name: limit
          in: query
          schema: { type: integer }
        - name: offset
          in: query
          schema: { type: integer }
      responses:
        '200': { description: OK }
  /alerts/{id}/resolve:
    post:
      summary: Mark alert as resolved
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
components:
  schemas:
    Client:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        contact_person: { type: string }
        email: { type: string }
        phone: { type: string }
        address: { type: string }
    Offer:
      type: object
      properties:
        id: { type: integer }
        offer_number: { type: string }
        client_id: { type: integer }
        date: { type: string, format: date-time }
        subject: { type: string }
        items: { type: string, description: jsonb string }
        total_price: { type: number }
        notes: { type: string }
        status: { type: string }
        pdf_url: { type: string }
    Service:
      type: object
      properties:
        id: { type: integer }
        client_id: { type: integer }
        domain: { type: string }
        service_type: { type: string }
        status: { type: string }
        last_check: { type: string, format: date-time }
        ssl_expiry: { type: string, format: date }
        domain_expiry: { type: string, format: date }
  /auth/register:
    post:
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                password: { type: string }
              required: [email, password]
      responses:
        '201': { description: Created }
        '400': { description: Bad request }
  /auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                password: { type: string }
              required: [email, password]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  expires_at: { type: integer, format: int64 }
        '401': { description: Unauthorized }
  /auth/reset/request:
    post:
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
              required: [email]
      responses:
        '200': { description: OK }
  /auth/reset/confirm:
    post:
      summary: Confirm password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token: { type: string }
        new_password: { type: string }

  /me:
    get:
      summary: Get current user's profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: integer }
                  email: { type: string }
                  created_at: { type: string, format: date-time }
                  updated_at: { type: string, format: date-time }
        '401': { description: Unauthorized }
              required: [token, new_password]
      responses:
        '200': { description: OK }
